
# yaml-language-server: $schema=https://raw.githubusercontent.com/awslabs/goformation/v4/schema/cloudformation.schema.json
AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: "CloudFront Website in non-public S3 bucket, generated by astro, with CD pipeline (later)"

Parameters:
  AppName: 
    Type: String
    Default: "cs-itp-ssg-cd"

Resources:
  MyStaticWebsiteBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "${AppName}-pub-dist-${AWS::Region}-${AWS::AccountId}"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
      # WebsiteConfiguration: # https://docs.aws.amazon.com/AmazonS3/latest/userguide/HostingWebsiteOnS3Setup.html
      # IndexDocument: index.html
      # ErrorDocument: error.html
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256

  # MyStaticWebsiteBucketPolicy:
  #   Type: AWS::S3::BucketPolicy
  #   Properties:
  #     Bucket: !Ref MyStaticWebsiteBucket
  #     PolicyDocument:
  #       Version: "2012-10-17"
  #       Statement:
  #         - Sid: PublicReadGetObject
  #           Effect: Allow
  #           Principal: "*"
  #           Action: s3:GetObject
  #           Resource: !Sub "arn:aws:s3:::${MyStaticWebsiteBucket}/*"

Outputs:
  # SiteURL:
  #   Value: !Sub "http://${MyStaticWebsiteBucket}.s3-website-${AWS::Region}.amazonaws.com" 
  BucketNameStaticWebsite:
    Value: !Sub "${MyStaticWebsiteBucket}" 
  DebugSyncCommand:
    Value: !Sub "aws s3 sync ../website s3://${MyStaticWebsiteBucket} --profile=kodekloud" 


